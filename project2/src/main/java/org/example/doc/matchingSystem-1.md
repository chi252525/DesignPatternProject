# 實作交友配對系統 ★

## 策略模式——你的配對策略是什麼呢？

**難度：★☆☆☆☆**

你正在開發一個交友配對系統 (Matchmaking System)。

### 對象資料 (Individual) 欄位

每位對象的資料包含以下欄位：

- **編號 (ID)**：正整數 (>0)，每位對象的編號都不同。
- **性別 (Gender)**：MALE 表示男生、FEMALE 表示女生。
- **年紀 (Age)**：正整數；至少 18 歲。
- **自我介紹 (Intro)**：長度約 0~200 的文字。
- **興趣 (Habits)**：可以為多個興趣，每個興趣以 1~10 長度的文字表示，每個興趣之間以一個逗號隔開。例如：打籃球,
  煮菜, 玩遊戲。
- **座標 (Coord)**：以 (x, y) 表示該用戶所在的 x 軸和 y 軸的位置。

### 主要配對策略

系統會根據以下策略幫每位用戶配對最適合的對象：

1. **距離先決 (Distance-Based)**：
    - 配對與自己距離最近的對象（若距離相同，選擇編號較小的對象）。
    - 距離計算公式：
      ```
      (x - x')^2 + (y - y')^2
      ```

2. **興趣先決 (Habit-Based)**：
    - 配對與自己興趣擁有最大交集量的對象（若興趣交集量相同，選擇編號較小的對象）。

### 反向策略 (Reverse)

- **反向距離先決**：配對與自己距離最遠的對象。
- **反向興趣先決**：配對與自己興趣擁有最小交集量的對象。

### 設計需求

由於客戶會不斷研發新的配對策略，我們希望系統能夠允許 Client (程式中系統的使用方，通常會是你的 Main
method) 在外部抽換系統的配對策略。

### 道館作答叮嚀

1. 請務必模仿「景點 - 策略模式｜基礎水平行為擴充」這部影片中的思路示範，要遵照底下思路來套用設計模式：

### 作答引導

#### OOA 設計

1. **類別建模**：根據需求，首先識別出關鍵類別：
    - **Individual**：表示每位對象，包含上述的欄位（ID、性別、年齡、自我介紹、興趣、座標）。
    - **MatchmakingSystem**：負責配對行為的執行。

2. **行為變動性**：
    - 配對策略是可變的，未來可能會增加更多的策略。
    - 當需要改變配對行為時，如何避免改動現有代碼？
    - 抓到至少一道「行為變動性」的 Force（以紅色箭頭或是便條紙表達 Force），
      將之擺在行為變動之處（如：該操作或是行為便條紙旁）。
      並用文字清楚說明：是哪一種行為引起變動？未來有可能會添加何等新行為？


3. **擴展性**：
    - 然後再抓到另外一道「擴充性」的 Force，並用文字清楚說明：在擴充「什麼行為」時，希望能不必修改「哪些類別」？
      接著抓上述兩道 Forces 的衝突點，並總結成一句 Problem（可以以便條紙簡單標註）
    - 如果新增策略，如何不改動現有的類別？應該能夠輕鬆擴展策略，不影響核心系統。

4. **衝突點**：
    - 配對策略的變動與擴展性之間的衝突。如何避免在不同的配對策略間引入過多的變數，導致代碼膨脹？

#### OOD 設計

- 解決衝突的問題：使用策略模式將不同的配對行為封裝成不同的類別，並將其抽象成接口。
- **步驟**：
    - **Encapsulate what varies**：將距離先決與興趣先決封裝成不同的策略類別。
    - **Abstract common behaviors**：抽象出 `MatchmakingStrategy` 接口，定義配對方法。
    - **Delegation / Composition**：將配對行為委託給具體策略類別，而非由 `MatchmakingSystem` 直接處理。

### UML 類圖設計

```text
+----------------------------+
|       MatchmakingSystem     |
|----------------------------|
| - matchmakingStrategy: MatchmakingStrategy |
|----------------------------|
| + match(individual: Individual): Individual |
+----------------------------+
           |
           v
+----------------------------+     +----------------------------+
| MatchmakingStrategy (接口)  |<>-->| DistanceBasedMatchmakingStrategy |
|----------------------------|     +----------------------------+
| + match(individual: Individual): Individual |
+----------------------------+            ^
           |                              |
           v                              v
+----------------------------+     +----------------------------+
| HabitBasedMatchmakingStrategy |
+----------------------------+     +----------------------------+